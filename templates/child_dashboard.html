<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Suraksha Child</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            background-color: #0f172a; /* ‡§µ‡•ã ‡§°‡§æ‡§∞‡•ç‡§ï ‡§®‡•á‡§µ‡•Ä ‡§¨‡•ç‡§≤‡•Ç ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° */
            height: 100vh; 
            display: flex; flex-direction: column; align-items: center; 
            color: white; overflow: hidden;
        }

        /* --- HEADER & MENU --- */
        .header {
            width: 100%; padding: 20px;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 100;
        }
        .menu-btn { font-size: 1.5rem; cursor: pointer; }
        .app-logo { font-size: 1.2rem; font-weight: 700; color: #3b82f6; } /* suraksha blue text */
        
        /* --- SIDE MENU (Overlay) --- */
        .side-menu {
            position: fixed; top: 0; left: -280px; width: 280px; height: 100%;
            background: white; z-index: 5000; transition: 0.3s ease;
            box-shadow: 2px 0 10px rgba(0,0,0,0.5); display: flex; flex-direction: column;
        }
        .side-menu.open { left: 0; }
        
        .menu-header-blue {
            background: #1877F2; height: 160px; padding: 20px;
            display: flex; flex-direction: column; justify-content: flex-end; color: white;
        }
        .menu-list { padding: 10px 0; }
        .menu-item {
            padding: 15px 20px; display: flex; align-items: center; gap: 15px;
            color: #333; text-decoration: none; font-size: 1rem; font-weight: 500;
        }
        .menu-item i { color: #1877F2; width: 20px; text-align: center; }

        /* --- MAIN PROFILE SECTION (Photo 3198.jpg Style) --- */
        .main-content {
            flex: 1; display: flex; flex-direction: column; align-items: center; width: 100%; padding-top: 20px;
        }

        .child-name { font-size: 2rem; font-weight: 700; margin-bottom: 5px; }
        .status-text { color: #94a3b8; font-size: 0.8rem; letter-spacing: 1px; margin-bottom: 30px; text-transform: uppercase; }

        .profile-container { position: relative; margin-bottom: 40px; }
        .profile-img {
            width: 140px; height: 140px; border-radius: 50%;
            border: 4px solid #3b82f6; object-fit: cover;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        .camera-icon {
            position: absolute; bottom: 5px; right: 5px;
            background: #f0f2f5; color: #333; width: 35px; height: 35px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; border: 2px solid white;
        }

        /* --- BOTTOM CARD (Safety Shield & SOS) --- */
        .bottom-card {
            background: white; width: 100%; flex: 1;
            border-top-left-radius: 30px; border-top-right-radius: 30px;
            padding: 30px 20px; text-align: center;
            display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
        }

        .connected-badge {
            background: #e0f2fe; color: #0284c7; padding: 8px 20px;
            border-radius: 20px; font-weight: 700; font-size: 0.9rem;
            display: flex; align-items: center; gap: 8px; margin-bottom: 15px;
        }
        .dot { width: 8px; height: 8px; background: #0284c7; border-radius: 50%; }

        .info-txt { color: #64748b; font-size: 0.9rem; margin-bottom: 30px; }

        /* üî• RED WIDE SOS BUTTON (Photo 3198.jpg) */
        .sos-btn-wide {
            width: 100%; max-width: 300px;
            background: linear-gradient(to right, #ff416c, #ff4b2b);
            color: white; padding: 18px; border-radius: 15px;
            font-size: 1.2rem; font-weight: 700; border: none;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            box-shadow: 0 10px 20px rgba(255, 75, 43, 0.3);
            cursor: pointer; animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* --- üî• PAIRING OVERLAY (Photo 3205.jpg Style) --- */
        .pairing-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #f0f2f5; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px;
        }
        .pair-card {
            background: white; padding: 30px; border-radius: 20px;
            width: 100%; max-width: 340px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        .link-icon { font-size: 3rem; color: #1877F2; margin-bottom: 15px; }
        .pair-input {
            width: 100%; padding: 12px; margin: 20px 0; border: 2px solid #e1e8ed;
            border-radius: 10px; font-size: 1.2rem; text-align: center; font-weight: bold; letter-spacing: 2px;
            outline: none; transition: 0.3s;
        }
        .pair-input:focus { border-color: #1877F2; }
        .pair-btn-blue {
            background: #1877F2; color: white; border: none; padding: 14px;
            width: 100%; border-radius: 10px; font-size: 1rem; font-weight: bold; cursor: pointer;
        }
        .logout-link { display: block; margin-top: 20px; color: #dc2626; text-decoration: none; font-size: 0.9rem; }

        #child_file_input { display: none; }
    </style>
</head>
<body>

    {% if not parent %}
    <div class="pairing-overlay">
        <div class="pair-card">
            <div class="link-icon"><i class="fa-solid fa-link"></i></div>
            <h2 style="color:#1c1e21; margin-bottom:10px;">Connect Parent</h2>
            <p style="color:#65676b; font-size:0.9rem; line-height:1.4;">Enter the pairing code from parent's app to link this device.</p>
            
            <form action="{{ url_for('pair_device') }}" method="POST">
                <input type="text" name="pairing_code" class="pair-input" placeholder="C82461" required autocomplete="off">
                <button type="submit" class="pair-btn-blue">Connect Now</button>
            </form>
            
            <a href="{{ url_for('logout') }}" class="logout-link">Logout</a>
        </div>
    </div>
    {% endif %}

    <div class="side-menu" id="sideMenu">
        <div class="menu-header-blue">
            <h2 style="font-size: 1.5rem;">suraksha</h2>
            <p style="opacity: 0.9; font-size: 0.9rem;">Premium Protection</p>
        </div>
        <div class="menu-list">
            <a href="#" class="menu-item"><i class="fa-solid fa-user-circle"></i> My Profile</a>
            <a href="#" class="menu-item"><i class="fa-solid fa-clock-rotate-left"></i> Location History</a>
            <a href="#" class="menu-item"><i class="fa-solid fa-shield-halved"></i> Privacy Policy</a>
            <a href="#" class="menu-item"><i class="fa-solid fa-handshake-angle"></i> Support</a>
            <a href="{{ url_for('logout') }}" class="menu-item" style="color:red;"><i class="fa-solid fa-power-off" style="color:red;"></i> Logout</a>
        </div>
    </div>

    <div class="header">
        <i class="fa-solid fa-bars menu-btn" onclick="document.getElementById('sideMenu').classList.toggle('open')"></i>
        <div class="app-logo">suraksha</div>
        <i class="fa-solid fa-ellipsis-vertical menu-btn"></i>
    </div>

    <div class="main-content" onclick="document.getElementById('sideMenu').classList.remove('open')">
        
        <div class="child-name">{{ child_info.name if child_info else username }}</div>
        <div class="status-text">LIVE PROTECTION ACTIVE</div>

        <div class="profile-container" onclick="document.getElementById('child_file_input').click()">
            <img src="{{ profile_pic_url or url_for('static', filename='default-profile.png') }}" class="profile-img" onerror="this.src='{{ url_for('static', filename='default-profile.png') }}'">
            <div class="camera-icon"><i class="fa-solid fa-camera"></i></div>
        </div>

        <div class="bottom-card">
            <div class="connected-badge">
                <div class="dot"></div> CONNECTED
            </div>
            <p class="info-txt">Security shield is active for your safety.</p>

            <button class="sos-btn-wide" id="sosBtn" onclick="triggerSOS()">
                <i class="fa-solid fa-bell"></i> SOS EMERGENCY
            </button>
        </div>
    </div>

    <form id="profileForm" action="{{ url_for('upload_profile_pic') }}" method="POST" enctype="multipart/form-data">
        <input type="file" name="profile_pic" id="child_file_input" accept="image/*" onchange="document.getElementById('profileForm').submit()">
    </form>

    <script>
        var isSOS = false;
        
        function triggerSOS() {
            isSOS = !isSOS;
            var btn = document.getElementById('sosBtn');
            
            if (isSOS) {
                btn.style.background = "#dc2626"; // Dark Red
                btn.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i> SENDING ALERT...';
                alert("SOS ALERT SENT TO PARENT!");
            } else {
                btn.style.background = "linear-gradient(to right, #ff416c, #ff4b2b)";
                btn.innerHTML = '<i class="fa-solid fa-bell"></i> SOS EMERGENCY';
            }
            
            // Location bhejho SOS flag ke sath
            sendLocation(true);
        }

        function sendLocation(immediate=false) {
            if (!navigator.geolocation) return;
            navigator.geolocation.getCurrentPosition(position => {
                fetch('/api/update_location', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        is_sos: isSOS
                    })
                });
            }, err => console.log(err), { enableHighAccuracy: true });
        }

        setInterval(sendLocation, 5000);
        sendLocation(); // Start immediately
    </script>
</body>
</html>

