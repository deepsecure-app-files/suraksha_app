<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Suraksha Child Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        
        /* üî• ‡§∏‡•Å‡§ß‡§æ‡§∞ 1: ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§ú‡§æ‡§Æ (Lock) */
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden !important; position: fixed; 
            background: #141e30; /* ‡§°‡§æ‡§∞‡•ç‡§ï ‡§•‡•Ä‡§Æ ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° */
            display: flex; flex-direction: column; align-items: center; 
        }
        
        * { box-sizing: border-box; font-family: 'Roboto', sans-serif; -webkit-tap-highlight-color: transparent; }

        /* --- Premium Header with 3-Dot Menu --- */
        .top-bar {
            width: 100%; padding: 20px; display: flex; 
            justify-content: space-between; align-items: center; color: white;
            z-index: 100;
        }
        .top-bar i { font-size: 1.5rem; cursor: pointer; }

        /* --- Dropdown Menu Settings --- */
        .menu-dropdown {
            position: absolute; top: 60px; right: 20px; background: white;
            border-radius: 12px; width: 180px; display: none;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); z-index: 1000;
        }
        .menu-dropdown a {
            display: flex; align-items: center; gap: 10px;
            padding: 12px 15px; text-decoration: none; color: #333;
            font-size: 0.9rem; border-bottom: 1px solid #eee;
        }
        .menu-dropdown a:last-child { border: none; }

        /* --- Profile Area (Look from Photo) --- */
        .header-content { text-align: center; color: white; margin-top: 10px; }
        .header-content h2 { font-size: 1.6rem; margin-bottom: 5px; }
        .header-content p { font-size: 0.85rem; opacity: 0.7; }

        .profile-section { position: relative; margin-top: 30px; }
        .profile-img { 
            width: 130px; height: 130px; border-radius: 50%; 
            border: 4px solid white; object-fit: cover;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
        }
        .cam-badge {
            position: absolute; bottom: 5px; right: 5px; 
            background: white; color: #141e30; width: 35px; height: 35px;
            border-radius: 50%; display: flex; align-items: center; 
            justify-content: center; font-size: 1rem; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* --- Main Protection Card --- */
        .active-card {
            background: white; width: 90%; margin-top: 40px;
            border-radius: 30px; padding: 30px 20px;
            text-align: center; position: relative;
        }
        .active-card h3 { font-size: 1.4rem; color: #1c1e21; margin-bottom: 20px; }

        .status-box {
            display: flex; align-items: center; justify-content: center;
            gap: 10px; color: #2ecc71; font-weight: bold; margin-bottom: 30px;
        }
        .dot { width: 12px; height: 12px; background: #2ecc71; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(2.5); opacity: 0; } }

        /* --- SOS Button --- */
        .sos-btn {
            background: #ff4b2b; color: white; border: none;
            width: 100%; padding: 20px; border-radius: 20px;
            font-size: 1.2rem; font-weight: 800; cursor: pointer;
            box-shadow: 0 10px 20px rgba(255, 75, 43, 0.3);
            text-transform: uppercase;
        }

        #child_file_input { display: none; }
    </style>
</head>
<body>

    <div class="top-bar">
        <i class="fa-solid fa-bars"></i>
        <i class="fa-solid fa-ellipsis-vertical" onclick="toggleMenu()"></i>
    </div>

    <div class="menu-dropdown" id="myMenu">
        <a href="#"><i class="fa-solid fa-gear"></i> App Settings</a>
        <a href="#"><i class="fa-solid fa-bell"></i> Notifications</a>
        <a href="{{ url_for('logout') }}" style="color: #ff4b2b;"><i class="fa-solid fa-power-off"></i> Logout</a>
    </div>

    <div class="header-content">
        <h2>Child Dashboard</h2>
        <p>{{ username }}</p>
    </div>

    <div class="profile-section">
        <form id="childProfileForm" action="{{ url_for('upload_profile_pic') }}" method="POST" enctype="multipart/form-data">
            <input type="file" name="profile_pic" id="child_file_input" accept="image/*" onchange="document.getElementById('childProfileForm').submit()">
        </form>
        <div onclick="document.getElementById('child_file_input').click()">
            <img src="{{ profile_pic_url or url_for('static', filename='default-profile.png') }}" class="profile-img">
            <div class="cam-badge"><i class="fa-solid fa-camera"></i></div>
        </div>
    </div>

    <div class="active-card">
        <h3>Active Protection</h3>
        
        <div class="status-box">
            <div class="dot"></div> Connected / Tracking
        </div>

        <div style="margin-bottom: 30px; color: #7f8c8d; font-size: 0.9rem;">
            <i class="fa-solid fa-shield-check"></i> Parent is monitoring live
        </div>

        <button class="sos-btn" onclick="triggerSOS()">
            SOS / Emergency
        </button>
    </div>

    <script>
        function toggleMenu() {
            var menu = document.getElementById("myMenu");
            menu.style.display = (menu.style.display === "block") ? "none" : "block";
        }

        // ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§ï‡§π‡•Ä‡§Ç ‡§≠‡•Ä ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ ‡§Æ‡•á‡§®‡•Ç ‡§¨‡§Ç‡§¶ ‡§π‡•ã ‡§ú‡§æ‡§è
        window.onclick = function(event) {
            if (!event.target.matches('.fa-ellipsis-vertical')) {
                document.getElementById("myMenu").style.display = "none";
            }
        }

        function triggerSOS() {
            alert("üö® EMERGENCY ALERT SENT TO PARENT!");
            sendLocation(true);
        }

        function sendLocation(isSOS = false) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    fetch('/api/update_location', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            is_sos: isSOS
                        })
                    });
                }, error => {
                    // GPS ‡§¨‡§Ç‡§¶ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ Network Fallback (Low Accuracy)
                    console.log("Using Network Location");
                }, { enableHighAccuracy: true, timeout: 10000 });
            }
        }

        setInterval(() => sendLocation(false), 5000);
        sendLocation(false);
    </script>
</body>
</html>

