<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Suraksha OneView</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        
        /* üî• ‡§∏‡•Å‡§ß‡§æ‡§∞ 1: ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® JAM ‡§î‡§∞ COPY ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§¨‡§Ç‡§¶ */
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden !important; position: fixed; 
            background: #0f172a; 
            display: flex; flex-direction: column; align-items: center; 
            -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; 
        }
        
        * { box-sizing: border-box; font-family: 'Roboto', sans-serif; -webkit-tap-highlight-color: transparent; }

        /* --- Facebook Style Top Branding --- */
        .top-bar {
            width: 100%; padding: 15px 20px; display: flex; 
            justify-content: space-between; align-items: center; z-index: 100;
        }
        .app-name-brand {
            color: #1877F2; font-size: 1.8rem; font-weight: 800; 
            letter-spacing: -1px; text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .top-bar i { color: white; font-size: 1.4rem; cursor: pointer; padding: 5px; }

        /* --- Side Menus --- */
        .side-panel {
            position: absolute; top: 0; left: -280px; width: 280px; height: 100%;
            background: white; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 2000;
            box-shadow: 10px 0 30px rgba(0,0,0,0.6);
        }
        .side-panel.open { left: 0; }
        .panel-header { background: #1877F2; padding: 40px 20px; color: white; }
        .panel-header h3 { font-size: 1.5rem; }
        
        .dot-menu {
            position: absolute; top: 65px; right: 20px; background: white;
            border-radius: 12px; width: 190px; display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4); z-index: 1000;
        }
        .dot-menu a {
            display: flex; align-items: center; gap: 12px; padding: 14px 18px;
            text-decoration: none; color: #333; font-size: 0.95rem; border-bottom: 1px solid #f0f2f5;
        }

        /* --- ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§î‡§∞ ‡§®‡§æ‡§Æ (‡§¨‡§°‡§º‡§æ ‡§î‡§∞ Facebook ‡§ú‡•à‡§∏‡§æ) --- */
        .profile-container { text-align: center; margin-top: 5px; width: 100%; }
        
        /* üî• ‡§∏‡•Å‡§ß‡§æ‡§∞ 2: ‡§¨‡§ö‡•ç‡§ö‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¨‡§°‡§º‡§æ ‡§î‡§∞ ‡§¨‡•ã‡§≤‡•ç‡§° */
        .child-display-name { 
            color: white; font-size: 2.2rem; font-weight: 700; 
            margin-bottom: 5px; text-transform: capitalize;
        }
        .sub-text { color: #94a3b8; font-size: 0.85rem; letter-spacing: 2px; font-weight: 500; }

        .image-wrapper { position: relative; display: inline-block; margin-top: 25px; }
        .profile-pic { 
            width: 140px; height: 140px; border-radius: 50%; 
            border: 5px solid #1877F2; object-fit: cover;
            box-shadow: 0 0 25px rgba(24, 119, 242, 0.3);
        }
        .cam-icon-btn {
            position: absolute; bottom: 8px; right: 8px; 
            background: #e4e6eb; color: #1c1e21; width: 38px; height: 38px;
            border-radius: 50%; display: flex; align-items: center; 
            justify-content: center; font-size: 1.1rem; box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        /* --- Main Status Card --- */
        .main-card {
            background: white; width: 92%; margin-top: 35px;
            border-radius: 30px; padding: 35px 20px;
            text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
        .active-label {
            display: inline-flex; align-items: center; gap: 10px;
            color: #1877F2; font-weight: 800; font-size: 1rem; margin-bottom: 25px;
            background: #e7f3ff; padding: 8px 20px; border-radius: 50px;
        }
        .pulse-ring { width: 10px; height: 10px; background: #1877F2; border-radius: 50%; animation: ring 2s infinite; }
        @keyframes ring { 0% { box-shadow: 0 0 0 0 rgba(24, 119, 242, 0.5); } 70% { box-shadow: 0 0 0 15px rgba(24, 119, 242, 0); } 100% { box-shadow: 0 0 0 0 rgba(24, 119, 242, 0); } }

        .sos-action-btn {
            background: linear-gradient(135deg, #ff416c, #ff4b2b); 
            color: white; border: none; width: 100%; padding: 20px; 
            border-radius: 20px; font-size: 1.4rem; font-weight: 900; 
            cursor: pointer; box-shadow: 0 10px 20px rgba(255, 75, 43, 0.3);
            display: flex; align-items: center; justify-content: center; gap: 12px;
        }

        #child_file_input { display: none; }
    </style>
</head>
<body>

    <div class="top-bar">
        <i class="fa-solid fa-bars-staggered" onclick="openNav()"></i>
        <div class="app-name-brand">suraksha</div>
        <i class="fa-solid fa-ellipsis-vertical" onclick="openDots()"></i>
    </div>

    <div class="side-panel" id="sideNav">
        <div class="panel-header">
            <h3>suraksha</h3>
            <p>Premium Protection</p>
        </div>
        <a href="#" class="menu-item"><i class="fa-solid fa-circle-user"></i> My Profile</a>
        <a href="#" class="menu-item"><i class="fa-solid fa-clock-rotate-left"></i> Location History</a>
        <a href="#" class="menu-item"><i class="fa-solid fa-handshake-angle"></i> Support</a>
    </div>

    <div class="dot-menu" id="dotNav">
        <a href="#"><i class="fa-solid fa-gears"></i> Settings</a>
        <a href="#"><i class="fa-solid fa-bell"></i> Alerts</a>
        <a href="{{ url_for('logout') }}" style="color: #ff4b2b;"><i class="fa-solid fa-power-off"></i> Logout</a>
    </div>

    <div class="profile-container">
        <div class="child-display-name">{{ username }}</div>
        <div class="sub-text">LIVE PROTECTION ACTIVE</div>

        <div class="image-wrapper">
            <form id="childProfileForm" action="{{ url_for('upload_profile_pic') }}" method="POST" enctype="multipart/form-data">
                <input type="file" name="profile_pic" id="child_file_input" accept="image/*" onchange="document.getElementById('childProfileForm').submit()">
            </form>
            <div onclick="document.getElementById('child_file_input').click()">
                <img src="{{ profile_pic_url or url_for('static', filename='default-profile.png') }}" class="profile-pic">
                <div class="cam-icon-btn"><i class="fa-solid fa-camera"></i></div>
            </div>
        </div>
    </div>

    <div class="main-card">
        <div class="active-label">
            <div class="pulse-ring"></div> CONNECTED
        </div>
        <p style="color: #64748b; font-size: 0.95rem; margin-bottom: 30px; font-weight: 500;">
            Security shield is active for your safety.
        </p>
        <button class="sos-action-btn" onclick="triggerSOSAlert()">
            <i class="fa-solid fa-land-mine-on"></i> SOS EMERGENCY
        </button>
    </div>

    <script>
        function openNav() { document.getElementById("sideNav").classList.toggle("open"); }
        function openDots() {
            var d = document.getElementById("dotNav");
            d.style.display = (d.style.display === "block") ? "none" : "block";
        }
        
        window.onclick = function(e) {
            if (!e.target.matches('.fa-bars-staggered') && !e.target.closest('.side-panel')) {
                document.getElementById("sideNav").classList.remove("open");
            }
            if (!e.target.matches('.fa-ellipsis-vertical')) {
                document.getElementById("dotNav").style.display = "none";
            }
        }

        function triggerSOSAlert() {
            if(confirm("Send Emergency Alert to Parent?")) {
                sendLocation(true);
                alert("SOS Sent! Parent has been notified.");
            }
        }

        function sendLocation(isSOS = false) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    fetch('/api/update_location', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            latitude: pos.coords.latitude,
                            longitude: pos.coords.longitude,
                            accuracy: pos.coords.accuracy,
                            is_sos: isSOS
                        })
                    });
                }, err => { console.log("Network Mode Active"); }, 
                { enableHighAccuracy: true, timeout: 10000 });
            }
        }
        setInterval(() => sendLocation(false), 5000);
        sendLocation(false);
    </script>
</body>
</html>
